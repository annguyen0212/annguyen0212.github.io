<!DOCTYPE html>
<html>
  <head>
    <title>Experiment</title>
    <script src="jspsych.js"></script>
    <script src="plugins/jspsych-html-keyboard-response.js"></script>
    <script src="plugins/jspsych-audio-keyboard-response.js"></script>
    <script src="plugins/jspsych-audio-button-response.js"></script>


    <link href="css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>  
  </body>
  <script>
   var timeline = [];
   var welcome = {
      type: "html-keyboard-response",
      stimulus: "<p> Welcome to the experiment! <br> Today you are going to watch the adventure of Billy and Julie. Throughout the story, there will be occasional questions. Whenever you are done with a screen, press space to continue. <p>"
    };
    
    
    var slide1 = {   
       type: 'audio-button-response',
     stimulus: 'sound/q1.wav',
      prompt: "<img class='center-fit' src='image/1.jpg'> ",
    choices: ['Play Again', 'Continue'],
  
};
      
      var repeat1 = {
  timeline: [slide1],
  
  loop_function: function(){
    data = jsPsych.data.getLastTrialData().values()[0]
      console.log(data._button_pressed)
    if(data.button_pressed == "0"){
      return true; // loop again!
    } else {
      return false; // continue
    }
  }
}
      
      var repeat2 = {
  timeline: [{   
       type: 'audio-button-response',
     stimulus: 'sound/q1.wav',
      prompt: "<img class='center-fit' src='image/2.jpg'> ",
    choices: ['Play Again', 'Continue'],
  
}],
  
  loop_function: function(){
    data = jsPsych.data.getLastTrialData().values()[0]
      console.log(data._button_pressed)
    if(data.button_pressed == "0"){
      return true; // loop again!
    } else {
      return false; // continue
    }
  }
}
    
       var repeat3 = {
  timeline: [{   
       type: 'audio-button-response',
     stimulus: 'sound/q1.wav',
      prompt: "<img class='center-fit' src='image/3.jpg'> ",
    choices: ['Play Again', 'Continue'],
  
}],
  
  loop_function: function(){
    data = jsPsych.data.getLastTrialData().values()[0]
      console.log(data._button_pressed)
    if(data.button_pressed == "0"){
      return true; // loop again!
    } else {
      return false; // continue
    }
  }
}
       
        var repeat4 = {
  timeline: [{   
       type: 'audio-button-response',
     stimulus: 'sound/q1.wav',
      prompt: "<img class='center-fit' src='image/4.jpg'> ",
    choices: ['Play Again', 'Continue'],
  
}],
  
  loop_function: function(){
    data = jsPsych.data.getLastTrialData().values()[0]
      console.log(data._button_pressed)
    if(data.button_pressed == "0"){
      return true; // loop again!
    } else {
      return false; // continue
    }
  }
}
        
         var repeat5 = {
  timeline: [{   
       type: 'audio-button-response',
     stimulus: 'sound/q1.wav',
      prompt: "<img class='center-fit' src='image/5.jpg'> ",
    choices: ['Play Again', 'Continue'],
  
}],
  
  loop_function: function(){
    data = jsPsych.data.getLastTrialData().values()[0]
      console.log(data._button_pressed)
    if(data.button_pressed == "0"){
      return true; // loop again!
    } else {
      return false; // continue
    }
  }
}
       
      timeline.push(welcome);
      timeline.push(repeat1);
      timeline.push(repeat2);
      timeline.push(repeat3);
      timeline.push(repeat4);
      timeline.push(repeat5);

      function saveData(name, data){
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'savefile.php'); // 'write_data.php' is the path to the php file described above.
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.send(JSON.stringify({filename: name, filedata: data}));
}

      
     jsPsych.init({
      timeline: timeline,
     fullscreen: true,
      on_finish: function(){ saveData("experiment_data", jsPsych.data.get().csv()); 
                           jsPsych.data.get().localSave('csv','mydata.csv');}
    });
  </script>
</html>
